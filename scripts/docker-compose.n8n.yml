# ══════════════════════════════════════════════════════════════════════════════
# VOID — n8n Local Development Stack
# ══════════════════════════════════════════════════════════════════════════════
# Usage: docker compose -f scripts/docker-compose.n8n.yml up -d

services:
  ngrok:
    image: ngrok/ngrok:latest
    container_name: void-ngrok
    command: http n8n:5678 --authtoken 36VOzNslbydt3gGWylMv2gyBfa8_32DGnPZuhZvDgEhFmHE7e
    ports:
      - "4040:4040"
    depends_on:
      - n8n

  n8n:
    image: n8nio/n8n:latest
    container_name: void-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=https://3586e4a4fc50.ngrok-free.app
      - GENERIC_TIMEZONE=Asia/Dhaka
      - TZ=Asia/Dhaka
      # Allow workflows to call local services
      - N8N_RUNNERS_ENABLED=true
      - NODE_FUNCTION_ALLOW_EXTERNAL=*
      # API access for importing workflows
      - N8N_PUBLIC_API_DISABLED=false
      # Skip owner setup for headless operation
      - N8N_SKIP_OWNER_SETUP=true
      - N8N_PERSONALIZATION_ENABLED=false
      - TELEGRAM_BOT_TOKEN=8511416050:AAF7VRhFxvNT6pATHBhlsgpHpy0J56GqBYs
    volumes:
      - n8n-data:/home/node/.n8n
      - ../vault-template:/vault:rw
      - ../n8n-workflows:/workflows:ro
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  n8n-data:
